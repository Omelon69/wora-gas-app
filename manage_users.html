<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body{font-family:'Segoe UI',Roboto,sans-serif;background:#1e1e1e;margin:0;padding:20px;color:#e0e0e0}
    h2{margin:0 0 14px 0}
    table{width:100%;border-collapse:collapse;background:#2b2b2b;color:#fff}
    th,td{padding:8px;border-bottom:1px solid #444}
    th{background:#3a3a3a;text-align:left}
    input,select{background:#444;border:none;padding:4px;color:#fff;border-radius:3px;width:100%}
    button{background:#1976d2;color:#fff;padding:6px 14px;border:none;border-radius:4px;cursor:pointer}
    button[disabled]{opacity:.6;cursor:not-allowed}
  </style>
  <script>
    function loadUsers(){
      const tbody = document.getElementById('userTableBody');
      tbody.innerHTML = `<tr><td colspan="4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>`;
      google.script.run.withSuccessHandler(renderTable).getAllUsers();
    }

    function renderTable(rows){
      const tbody = document.getElementById('userTableBody');
      tbody.innerHTML = '';
      (rows||[]).forEach((r)=>{
        const email  = r[0] || '';
        const role   = r[1] || '';
        const name   = r[2] || '';
        const status = r[3] || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£';

        const tr = document.createElement('tr');

        const tdEmail = document.createElement('td');
        tdEmail.textContent = email;

        const tdRole = document.createElement('td');
        const selRole = document.createElement('select');
        ['AdminApp','AdminSale','AdminService','Sales','Manager',''].forEach(v=>{
          if (v==='') return; // ‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà option ‡∏ß‡πà‡∏≤‡∏á
          const opt = document.createElement('option');
          opt.value = v; opt.textContent = v;
          if (v === role) opt.selected = true;
          selRole.appendChild(opt);
        });
        tdRole.appendChild(selRole);

        const tdName = document.createElement('td');
        const inpName = document.createElement('input');
        inpName.value = name;
        tdName.appendChild(inpName);

        const tdStatus = document.createElement('td');
        const selStatus = document.createElement('select');
        ['‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£','‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥','‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò'].forEach(v=>{
          const opt = document.createElement('option');
          opt.value = v; opt.textContent = v;
          if ((status||'') === v) opt.selected = true;
          selStatus.appendChild(opt);
        });
        tdStatus.appendChild(selStatus);

        tr.appendChild(tdEmail);
        tr.appendChild(tdRole);
        tr.appendChild(tdName);
        tr.appendChild(tdStatus);

        tbody.appendChild(tr);
      });
    }

    function saveUsers(){
      const btn = document.getElementById('saveBtn');
      btn.disabled = true; btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

      const updates = [];
      document.querySelectorAll('#userTableBody tr').forEach(tr=>{
        const sel = tr.querySelectorAll('select');
        const inp = tr.querySelectorAll('input');
        updates.push([ sel[0].value || '', inp[0].value || '', sel[1].value || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' ]);
      });

      google.script.run.withSuccessHandler(()=>{
        alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        btn.disabled = false; btn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
      }).withFailureHandler(()=>{
        alert('‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
        btn.disabled = false; btn.textContent = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
      }).updateUserInfo(updates);
    }

    window.onload = loadUsers;
  </script>
</head>
<body>
  <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
  <table>
    <thead>
      <tr><th>Email</th><th>Role</th><th>Name</th><th>Status</th></tr>
    </thead>
    <tbody id="userTableBody"></tbody>
  </table>
  <br>
  <button id="saveBtn" onclick="saveUsers()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
</body>
</html>
